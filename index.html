<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.0/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.3.0/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="shit.js" type="text/javascript"></script>
<script src="stemmer.js" type="text/javascript"></script>
<style type="text/css">
  h1,h2,h3{line-height:1.6; font-size: 25px !important;}
  header{line-height: 1.6}
  body{margin:40px auto;max-width:650px;color:#444;padding:0 10px}}
</style>
<link rel="stylesheet" type="text/css" href="reddit.css">

<script type="text/babel">
 var BBC_feed = 'http://feeds.bbci.co.uk/news/world/rss.xml';
 var NYT_feed = 'http://rss.nytimes.com/services/xml/rss/nyt/World.xml';

 var prepare_text = function(str){
  var re_letters = /[^a-zA-Z]/g;
  str = str.replace(re_letters, ' ').toLowerCase();
  str = str.removeStopWords();
  str = str.split(/\ +/);
  return str;
 }
 var RSS_feeds = [BBC_feed, NYT_feed];
 var articles = [];
 var finished_loading_count = 0;
 RSS_feeds.forEach(function(obj){
   $.get(obj, function(data){
      if (typeof data == "string"){
        var new_data = $.parseXML(data);
      } else {
        var new_data = data;
      }
      var texts= [];
      $(new_data).find("item").each(function(){
        console.log($(this).text());
        var desc = $(this).find("description").text();
        var title = $(this).find("title").text();
        var cur_words = desc+' '+title;
        cur_words = prepare_text(cur_words);
        cur_words = cur_words.map(function(x){return stemmer(x, false);});
        cur_words = cur_words.join(' ');
        texts.push({text: cur_words});
      })
      articles = articles.concat(texts);
      finished_loading_count ++;
      if (finished_loading_count==RSS_feeds.length){
        generateVoc(articles);
      }
   }); 
 })
 var vocab = [];
 var generateVoc = function(obj){
  var dict = {};
  obj.forEach(function(obj){
    var word_list = obj.text.split(' ');
    word_list.forEach(function(obj){
      dict[obj] = (dict[obj]||0)+1;
    })
  });
  vocab = Object.keys(dict).sort(function(a, b){return dict[b]-dict[a];});
  for(var i=0; i<20; i++){
    console.log(vocab[i], dict[vocab[i]]);
  }
  console.log(vocab.length);
  console.log(articles.length);

 }


 console.log('hey');
</script>

<div id="content">
  hey
</div>



</html>